import paho.mqtt.client as mqtt
import time

# ThÃ´ng tin broker
broker = "192.168.1.100"   # ğŸ“ Äá»•i IP thÃ nh cá»§a báº¡n
port = 1883
topic = "rpi/test/topic"

# HÃ m callback khi káº¿t ná»‘i thÃ nh cÃ´ng
def on_connect(client, userdata, flags, rc):
    if rc == 0:
        print("âœ… Káº¿t ná»‘i MQTT thÃ nh cÃ´ng.")
    else:
        print("âŒ Káº¿t ná»‘i tháº¥t báº¡i, mÃ£ lá»—i:", rc)

# Táº¡o MQTT client
client = mqtt.Client()

# GÃ¡n callback
client.on_connect = on_connect

# Káº¿t ná»‘i Ä‘áº¿n broker
client.connect(broker, port, 60)

# VÃ²ng láº·p xá»­ lÃ½ ná»n (báº¯t buá»™c náº¿u dÃ¹ng callback)
client.loop_start()

try:
    while True:
        payload = "Hello from Raspberry Pi 5!"
        client.publish(topic, payload)
        print(f"ğŸ“¤ ÄÃ£ gá»­i: {payload}")
        time.sleep(5)  # Gá»­i má»—i 5 giÃ¢y
except KeyboardInterrupt:
    print("ğŸ›‘ Dá»«ng bá»Ÿi ngÆ°á»i dÃ¹ng.")
finally:
    client.loop_stop()
    client.disconnect()
