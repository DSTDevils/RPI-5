import time
import smbus

# Äá»‹a chá»‰ I2C cá»§a cáº£m biáº¿n SHT30
SHT30_ADDR = 0x44

# Khá»Ÿi táº¡o I2C bus
bus = smbus.SMBus(1)

def read_sht30():
    try:
        # Gá»­i lá»‡nh Ä‘o tá»›i SHT30 (cháº¿ Ä‘á»™ high repeatability, clock stretching disabled)
        bus.write_i2c_block_data(SHT30_ADDR, 0x2C, [0x06])
        time.sleep(0.5)  # Chá» dá»¯ liá»‡u sáºµn sÃ ng

        # Äá»c 6 byte dá»¯ liá»‡u: Temp MSB, Temp LSB, Temp CRC, Hum MSB, Hum LSB, Hum CRC
        data = bus.read_i2c_block_data(SHT30_ADDR, 0x00, 6)

        # Chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u nhiá»‡t Ä‘á»™ vÃ  Ä‘á»™ áº©m
        temp_raw = data[0] << 8 | data[1]
        hum_raw = data[3] << 8 | data[4]

        temperature = -45 + (175 * (temp_raw / 65535.0))
        humidity = 100 * (hum_raw / 65535.0)

        return round(temperature, 2), round(humidity, 2)
    except Exception as e:
        print("âŒ Error reading SHT30:", e)
        return None, None

# Cháº¡y thá»­
if __name__ == "__main__":
    while True:
        temp, hum = read_sht30()
        if temp is not None:
            print(f"ğŸŒ¡ï¸ Temperature: {temp} Â°C | ğŸ’§ Humidity: {hum} %")
        else:
            print("âš ï¸ KhÃ´ng Ä‘á»c Ä‘Æ°á»£c dá»¯ liá»‡u tá»« cáº£m biáº¿n.")
        time.sleep(2)
